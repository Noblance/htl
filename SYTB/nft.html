<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>NFT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <header style="background-color: black; color: white; height: 100px; font-size: 50px;"><a class="text-decoration-none text-white d-flex justify-content-center" href="../index.html">HTL Wiki</a></header>
    <div style="height: 10px;" class="width-100 bg-warning"></div>
    <div id="container">
            <div class="container-fluid" style="background-color: rgb(74, 74, 74);">
                <ul class="navbar-nav d-flex flex-row">
                  <li class="nav-item">
                    <div class="dropdown">
                        <button type="button" style="background-color: rgb(74, 74, 74);color: white;" class="btn dropdown-toggle" data-bs-toggle="dropdown">
                          Topics
                        </button>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="../SYTB/indexsytb.html">SYTB</a></li>
                          <li><a class="dropdown-item" href="../SYTE/indexsyte.html">SYTE</a></li>
                        </ul>
                      </div>
                  </li>
                  <li class="nav-item">
                    <div class="dropdown">
                        <button type="button" style="background-color: rgb(74, 74, 74); color: white;" class="btn dropdown-toggle mx-4" data-bs-toggle="dropdown">
                          Units
                        </button>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item text-decoration-none text-black" href="apacheauth.html" target=”_blank”> &#09; Apache</a></li>
                          <li><a class="dropdown-item text-decoration-none text-black" href="bash.html" target=”_blank”> &#09; Bash-Script</a></li>
                          <li><a class="dropdown-item text-decoration-none text-black" href="ipconf.html" target=”_blank”> &#09; IP-Konfiguration</a></li>
                          <li><a class="dropdown-item text-decoration-none text-black" href="linuxbasics.html" target=”_blank”> &#09; Linux-Basic</a></li>
                          <li><a class="dropdown-item text-decoration-none text-black" href="nft.html" target=”_blank”> &#09; NFT-Tables</a></li>
                        </ul>
                      </div>
                  </li>
                  <li class="nav-item">
                    <div class="dropdown">
                        <button type="button" style="background-color: rgb(74, 74, 74); color: white;" class="btn dropdown-toggle mx-4" data-bs-toggle="dropdown">
                          Shortcuts
                        </button>
                        <ul class="dropdown-menu">
                          <li><a class="dropdown-item text-decoration-none text-black" href="https:\\teams.microsoft.com" target=”_blank”> &#09; Teams</a></li>
                          <li><a class="dropdown-item text-decoration-none text-black" href="https:\\outlook.office.com" target=”_blank”> &#09; Outlook</a></li>
                          <li><a class="dropdown-item text-decoration-none text-black" href="https:\\ondrive.live.com" target=”_blank”> &#09; OneDrive</a></li>
                          <li><a class="dropdown-item text-decoration-none text-black" href="https:\\asopo.webuntis.com" target=”_blank”> &#09; WebUntis</a></li>
                          <li><a class="dropdown-item text-decoration-none text-black" href="https:\\blog.net-solve.at/category/1" target=”_blank”> &#09; Net-Solve</a></li>
                        </ul>
                      </div>
                  </li>
                </ul>
              </div>
           
        
        <div class="my-5">
            <h1>NFTables</h1>
            <p>NFTables ist ein Firewall-Programm, das bedeutet es hat die Funktion bestimte Port, Pakete, etc. zu filtern oder umzuleiten. Die Umleitfunktion
                ermöglicht es außerdem aus einer Linux-Maschine einen Router zu machen.
                <br>
                <br>
                NFTables hat einen bestimmten Aufbau:
                <h4>Table:</h4> Die Tabelle selber; sie kann unterschiedliche Familien ansprechen (ip,ip6,inet,arp,bridge,netdev)
                <h4>Chain:</h4> Die Kette ist eine Unterkategorie von der Tabelle; sie kann unterschiedliche Bearbeitungspunkte angeben (input, ouotput, forward,...), diese sind jedoch von der Familie abhängig
                <h4>Rule:</h4> Die Regel definiert dann wirklich was erlaubt oder nicht erlaubt ist 

                <h2>Beispiel</h2>
                <h4>Alle Ports sperren aber nur einen durchlassen</h4>
                <code class="code">
                    #nft add table ip filter <br>
                    #nft add chain ip filter output { type filter hook output priority 100\; policy drop\;}<br>
                    #nft add rule ip filter output tcp dport 53 counter accept<br>
                    #nft add rule ip filter output udp dport 53 counter accept<br>
                </code>
                Danach einen restart des Services NFTables machen: <span class="code">#service nftables restart</span>
                <br>
                <br>
                In diesem Fall wird jedes Paket dass mit dem Protokoll TCP, UDP an den Port 53 (DNS) ankommt durchgelassen und mit counter auch gleich mitgezählt. Alle anderen Pakete werden nicht durchgelassen.
                <br> 
                Man kann die Anzahl an Paketen sowie die ganze Tabelle mit <span class="code">#nft list ruleset</span> sehen.
                <br><br>
                Um eine alle Tabellen zu löschen: <span class="code">#nft flush ruleset</span>

                <h4>Masqueraden</h4>
                Die obengenante Routing-Funktion einbauen. In diesem Beispiel wird folgendes benötigt/benutzt
                <ul>
                    <li>3 PC/Maschinen</li>
                    <li>Wissen über  <a href="ipconf.html">Netzwerk- bzw. Schnitstellenkonfiguration</a></li>
                    <li>2 Interne Netze und 1 NAT Zugriff</li>
                </ul>
                Vor dem Prozess am Router ist es wichitg die Netzwerkkonfiguration so einzustellen:
                <ul>
                    <li>Router/PC 1: 2 Schnittstellen mit jeweils einer Maschine</li>
                    <li>PC 2: Schnitstelle zum Router; Gateway einstellen</li>
                    <li>PC 3: Schnitstelle zum Router; Gateway einstellen</li>
                </ul>
                Wichitg ist es, das die zwei "Clients" in unterschiedlichen Netzwerken liegen.
                <code class="code">
                    Am "Router"/PC 1 <br><br>
                    #echo 1 > /prov/sys/net/ipv4/ip_forwarding --> IP-Forwarding aktivieren <br>
                    #nft add table nat <br>
                    #nft add chain nat postrouting { type nat hook postrouting priority 100\;}<br>
                    #nft add rule nat postrouting ip saddr 192.168.1.0/24 oif enp0s3 masquerade<br>
                    #nft add rule nat postrouting ip saddr 192.168.2.0/24 oif enp0s3 masquerade<br>
                </code>
                Danach einen restart des Services NFTables machen: <span class="code">#service nftables restart</span>
                <br>
                <br>
                In diesem Fall wird jedes Paket dass mit den beiden Netzwerkadressen kommt an die Netzwerkschnitstelle des NATs weitergeleitet <br>
                <br> 
                Man kann die Anzahl an Paketen sowie die ganze Tabelle mit <span class="code">#nft list ruleset</span> sehen.
                <br><br>
                Alle Konfigurationen werden von NFTables (reine nft-commands) nicht gespeichert wenn man hherunterfährt, da kann es helfen ein <a href="bashscrip.html">Bash Script</a> zu erstellen
            </p>
        </div>

        
    </div>
    <footer style="background-color: gray;" class="d-flex flex-column align-self-end text-white">
        <br>
        <p>&copy; Noblance</p>
        <p>For good reasons to HTL Krems</p>
    </footer>
</body>
</html>
